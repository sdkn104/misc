<!DOCTYPE html>
<html>
<head>
<title>SheetJS JS-XLSX In-Browser HTML Table Export Demo</title>
<meta charset="utf-8" />
</head>
<body>

<script type="text/javascript" src="//unpkg.com/xlsx/dist/shim.min.js"></script>
<script type="text/javascript" src="//unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script type="text/javascript" src="//unpkg.com/blob.js@1.0.1/Blob.js"></script>
<script type="text/javascript" src="//unpkg.com/file-saver@1.3.3/FileSaver.js"></script>


<script>

function doit(type, fn, dl) {
	var url = "/static/template.xlsm";

	/* set up async GET request */
	var req = new XMLHttpRequest();
	req.open("GET", url, true);
	req.responseType = "arraybuffer";

	req.onload = function(e) {
		var data = new Uint8Array(req.response);
		var workbook = XLSX.read(data, {type:"array", bookVBA:true});

		var elt = document.getElementById('data-table');

		var ws1 = XLSX.utils.table_to_sheet(elt);
		XLSX.utils.book_append_sheet(workbook, ws1, "SheetJS");
		XLSX.writeFile(workbook, 'SheetJSTableExport.xlsm');
	
		//var wb = XLSX.utils.table_to_book(elt, {sheet:"Sheet JS"});
		//wb.vbaraw = workbook.vbaraw;
		//XLSX.writeFile(wb, 'SheetJSTableExport.xlsm');
	}
	req.send();
}
</script>


<div id="container"></div>
<script type="text/javascript">
/* initial table */
var aoa = [
	["This",   "is",     "a",    "Test"],
	["???????", "??????", "?å¥½", "???"],
	[1,        2,        3,      4],
	["Click",  "to",     "edit", "cells"]
];
var ws = XLSX.utils.aoa_to_sheet(aoa);
var html_string = XLSX.utils.sheet_to_html(ws, { id: "data-table", editable: true });
document.getElementById("container").innerHTML = html_string;
</script>
<br />

<pre><b>Export it!</b></pre>
<pre>XLSX Excel 2007+ XML</pre>
	<p id="xportxlsx" class="xport"><input type="submit" value="Export to XLSX!" onclick="doit('xlsx');"></p>
	<p id="xlsxbtn" class="btn">Flash required for actually downloading the generated file.</p>


<a href="/static/Book1.xlsm">book</a>

</body>
</html>
