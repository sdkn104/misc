<!DOCTYPE html>
<html>
<head>
<title>Dify.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="install">INSTALL</h1>
<p>https://docs.dify.ai/ja-jp/getting-started/install-self-hosted/docker-compose</p>
<h3 id="install-wsl2">Install WSL2</h3>
<p>https://learn.microsoft.com/en-us/windows/wsl/install</p>
<ol>
<li>install<pre class="hljs"><code><div><span class="hljs-comment"># (Run as administrator)</span>

<span class="hljs-comment"># install wsl</span>
wsl -<span class="hljs-literal">-install</span> Ubuntu
<span class="hljs-comment">#wsl --list --online</span>

<span class="hljs-comment">#if error occur in above installation process:</span>
<span class="hljs-comment">#dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart</span>
<span class="hljs-comment">#dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart</span>
<span class="hljs-comment">#shutdown /r /t 0</span>

<span class="hljs-comment"># check wsl version (must be 2)</span>
wsl <span class="hljs-literal">-l</span> <span class="hljs-literal">-v</span>
<span class="hljs-comment">#wsl --set-version Ubuntu 2</span>
</div></code></pre>
</li>
<li>setting
<ul>
<li>create admin user/password for Ubuntu</li>
<li>proxy setting for WSL2
<ul>
<li>https://qiita.com/dkoide/items/ca1f4549dc426eaf3735</li>
<li>https://zenn.dev/wsuzume/articles/f9935b47ce0b55</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment"># /etc/environment (env. vars. for all users and processes)</span>
HTTP_PROXY=http://proxy.xxx.com:xxx
http_proxy=http://proxy.xxx.com:xxx
HTTPS_PROXY=http://proxy.xxx.com:xxx
https_proxy=http://proxy.xxx.com:xxx
NO_PROXY=127.0.0.1,localhost
no_proxy=127.0.0.1,localhost
</div></code></pre>
</li>
</ul>
</li>
<li>check network on WSL2<pre class="hljs"><code><div>curl http://www.google.com
sudo curl http://www.google.com
</div></code></pre>
</li>
</ol>
<h3 id="install-docker-engine-on-wsl2">Install Docker Engine on WSL2</h3>
<p>https://docs.docker.com/engine/install/ -&gt; select &quot;Ubuntu&quot;</p>
<ul>
<li>Since commercial use of Docker Desktop in larger enterprises requires a paid subscription.</li>
<li>so, we use Docker Engine instead.</li>
</ul>
<ol>
<li>
<p>Install docker engine</p>
<ul>
<li>follow &quot;Install using the apt repository&quot; in https://docs.docker.com/engine/install/ubuntu/</li>
<li>if failed at <code>sudo docker run hello-world</code>, i.e., <code>docker pull</code> failed,<pre class="hljs"><code><div>sudo vi /etc/systemd/system/docker.service.d/override.conf  <span class="hljs-comment"># add the followings</span>
      [Service]
      Environment=<span class="hljs-string">"HTTP_PROXY=http://proxy.example.com:xx"</span>
      Environment=<span class="hljs-string">"HTTPS_PROXY=http://proxy.example.com:xx"</span>
sudo systemctl daemon-reload
sudo systemctl restart docker
sudo docker info  <span class="hljs-comment"># to check proxy setting for docker pulling</span>
</div></code></pre>
</li>
<li>if failed at others,
<ul>
<li>add to curl proxy option: --proxy http://proxy.xxx.com</li>
<li>add to apt-get proxy option: -o Acquire::http::Proxy=&quot;http://proxy.xxx.com&quot;</li>
<li>add to docker run proxy optin: -e HTTPS_PROXY=http::Proxy=http://proxy.xxx.com</li>
</ul>
</li>
</ul>
</li>
<li>
<p>install docker compose</p>
<ul>
<li>follow &quot;Install using the repository&quot; in
https://docs.docker.com/compose/install/linux/#install-using-the-repository<pre class="hljs"><code><div>sudo apt-get update
sudo apt-get install docker-compose-plugin
docker compose version

sudo systemctl status docker
<span class="hljs-comment">#sudo systemctl restart docker</span>
<span class="hljs-comment">#sudo systemctl stop docker</span>
</div></code></pre>
</li>
</ul>
</li>
</ol>
<ul>
<li>proxy setting for Docker
<ul>
<li>https://qiita.com/dkoide/items/ca1f4549dc426eaf3735</li>
<li>https://zenn.dev/wsuzume/articles/f9935b47ce0b55</li>
</ul>
</li>
</ul>
<h3 id="install-dify">install Dify</h3>
<p>https://docs.dify.ai/ja-jp/getting-started/install-self-hosted/docker-compose</p>
<pre class="hljs"><code><div><span class="hljs-comment"># install</span>
<span class="hljs-comment">#git config --global http.proxy http://proxy.xxx.com</span>
<span class="hljs-comment">#git config --global https.proxy http://proxy.xxx.com</span>
git <span class="hljs-built_in">clone</span> https://github.com/langgenius/dify.git
<span class="hljs-built_in">cd</span> dify/docker
cp .env.example .env
</div></code></pre>
<h3 id="run-dify">run Dify</h3>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> dify/docker
sudo docker compose up -d
<span class="hljs-comment"># -&gt; access with browser http://localhost</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">#check if Dify running</span>
sudo docker compose ps
</div></code></pre>
<h3 id="setting-network">Setting Network</h3>
<pre><code class="language-mermaid"><div class="mermaid">flowchart LR

%%要素・グループ
EXTNET([external subnet])
subgraph PC_OS[PC Windows]
  PCNIC["PC NIC<br>19.168.1.6"]
  vEther["virtual NIC<br>vEthernet(WSL)<br>172.31.160.1/20"]
  PCapp[[PC WebApp]]
  RT[("route table<br>default=
  PC NIC")]
end
VSW(["Virtual SW (Hub)<br>subnet"])
subgraph WSL[WSL2]
  eth0["eth0 NIC<br>172.31.169.237"]
  docker0["docker bridge NIC<br>docker0"]
  br_xxx1["docker bridge NIC<br>172.18.0.1"]
  br_xxx2["docker bridge NIC<br>172.19.0.1"]
  RT2["(route table)<br>default=eth0"]
end
bridge(["subnet<br>bridge"])
docker_default(["subnet<br>docker_default"])
docker_ssrf_proxy_network(["subnet<br>docker_ssrf_proxy_network"])
subgraph Docker
  nginx["docker-nginx-1<br>172.18.0.7"]
  api[docker-api-1]
  sandbox["docker-sandbox-1<br>172.19.0.3"]
end

%%関係
vEther == default === VSW
EXTNET === PCNIC
docker_default === nginx
docker_default === api
docker_ssrf_proxy_network === api
docker_ssrf_proxy_network === sandbox
VSW === eth0
docker0 === bridge
br_xxx1 == default === docker_default
br_xxx2 == default === docker_ssrf_proxy_network
PCNIC -. NAT:80 .-> eth0
vEther -. NAT:80 .-> eth0
PCapp -. Listen .-> PCNIC
PCapp -. Listen .-> vEther
eth0 -. NAT:80,443 .-> nginx
</div></code></pre>
<ul>
<li>listen 0.0.0.0 == listen all NICs in the host</li>
<li>check all NICs in the host
<ul>
<li><code>PS&gt; ipconfig</code></li>
<li><code>WSL&gt; ip addr</code></li>
</ul>
</li>
<li>check routing table of the host
<ul>
<li><code>PS&gt; route print</code></li>
<li><code>WSL&gt; route</code></li>
</ul>
</li>
<li>check networks in Docker
<ul>
<li><code>sudo docker network ls</code></li>
<li><code>sudo docker inspect docker-nginx-1</code></li>
</ul>
</li>
</ul>
<ul>
<li>
<p>network configuration:</p>
<ul>
<li>Host (real environment)</li>
<li>WSL2 (virtual environment)</li>
<li>Docker Container (semi-virtual environment)</li>
</ul>
</li>
<li>
<p>port mapping: WSL2 -&gt; docker container &quot;nginx&quot;</p>
<ul>
<li>mapping is specified in ports section of nginx in docker-compose.yaml</li>
<li>default:  0.0.0.0:80-&gt;80, 0.0.0.0:443-&gt;443
<ul>
<li>Mapping port 80 of WSL2 NICs to port 80 of docker container &quot;nginx&quot;</li>
</ul>
</li>
<li>check port mapping of nginx<pre class="hljs"><code><div>sudo docker compose ps -a
</div></code></pre>
</li>
<li>check listen ports in WSL2<pre class="hljs"><code><div>sudo lsof -i -nP
</div></code></pre>
</li>
</ul>
</li>
<li>
<p>port mapping:  Host -&gt; WSL2</p>
<ul>
<li>https://rcmdnk.com/blog/2021/03/01/computer-windows-network/</li>
<li>https://qiita.com/yururu_no_yu/items/1fe94eeff12bad910d58</li>
<li>https://qiita.com/omu_kato/items/f9a6b5a02e25f5f2a487</li>
<li>https://zenn.dev/yamamoto_11709/articles/1e90bc9f7b7500</li>
<li>https://scrapbox.io/hotchpotch/WSL2_%E7%92%B0%E5%A2%83%E3%81%B8%E3%81%AE_port_forwarding</li>
</ul>
<ul>
<li>Default fowarding: Any TCP port you listen on inside WSL2 is automatically forwarded to the Windows host’s localhost on the same port.</li>
<li>if you want use Dify from external client, do followings</li>
<li>WLS2 IP address is changed per startup</li>
</ul>
<ol>
<li>
<p>get WSL2 IP address (exec on WSL2)</p>
<pre class="hljs"><code><div>ifconfig eth0 | grep <span class="hljs-string">'inet '</span> | awk <span class="hljs-string">'{print $2}'</span>
  <span class="hljs-comment">#or</span>
ip addr show eth0 | sed -e <span class="hljs-string">'s/\// /g'</span> | awk <span class="hljs-string">'/inet /{print $2}'</span>
</div></code></pre>
</li>
<li>
<p>set port forwarding (exec on PowerShell)</p>
<pre class="hljs"><code><div>netsh.exe interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=80   connectaddress=WSL2_ADDRESS connectport=80
netsh.exe interface portproxy show v4tov4
<span class="hljs-comment">#netsh.exe interface portproxy delete v4tov4 listenport=80 listenaddress=0.0.0.0</span>
</div></code></pre>
</li>
<li>
<p>setting firewall</p>
<ul>
<li>open port 80 by Windows Defender Wirewall</li>
<li>https://support.borndigital.co.jp/hc/ja/articles/360002711593-Windows10%E3%81%A7%E7%89%B9%E5%AE%9A%E3%81%AE%E3%83%9D%E3%83%BC%E3%83%88%E3%82%92%E9%96%8B%E6%94%BE%E3%81%99%E3%82%8B</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment"># set firewall</span>
netsh advfirewall firewall add rule name=<span class="hljs-string">"★Dify TCP 80"</span> dir=<span class="hljs-keyword">in</span> action=allow protocol=TCP localport=<span class="hljs-number">80</span> profile=private,domain
<span class="hljs-comment"># show firewall</span>
netsh advfirewall firewall show rule name=<span class="hljs-string">"★Dify TCP 80"</span>
<span class="hljs-comment"># delete firewall</span>
netsh advfirewall firewall delete rule name=<span class="hljs-string">"★Dify TCP 80"</span>
</div></code></pre>
</li>
</ol>
<ul>
<li>
<p>instead of 1 and 2:</p>
<p>~/bin/wsl_port_forwarding.sh:</p>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash
</span>
IP=$(ip addr show eth0 | sed -e <span class="hljs-string">'s/\// /g'</span> | awk <span class="hljs-string">'/inet /{print $2}'</span>)
LISTENPORTS=(80) 

<span class="hljs-built_in">echo</span> IP=<span class="hljs-variable">$IP</span>
<span class="hljs-built_in">echo</span> LISTENPORTS=<span class="hljs-variable">$LISTENPORTS</span>

<span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${LISTENPORTS[@]}</span>"</span>
<span class="hljs-keyword">do</span>
  netsh.exe interface portproxy delete v4tov4 listenport=<span class="hljs-variable">$port</span>
  netsh.exe interface portproxy add    v4tov4 listenport=<span class="hljs-variable">$port</span> connectaddress=<span class="hljs-variable">$IP</span>
  netsh.exe interface portproxy show   v4tov4
<span class="hljs-keyword">done</span>
</div></code></pre>
<pre class="hljs"><code><div>PS&gt; wsl <span class="hljs-literal">-e</span>  /home/username/bin/wsl_port_forwarding.sh
</div></code></pre>
</li>
<li>
<p>to delete all port forwarding: <code>netsh.exe interface portproxy reset</code></p>
</li>
</ul>
<ol start="4">
<li>access from host PC or external PC:
<ul>
<li><code>http://IP_address_of_host_or_hostname:80</code></li>
</ul>
</li>
</ol>
<ul>
<li>to check listen ports in Host<pre class="hljs"><code><div>netstat -ano | grep LISTEN
</div></code></pre>
</li>
</ul>
</li>
</ul>
<h1 id="dify-setting">Dify Setting</h1>
<h3 id="llm-setting">LLM setting</h3>
<ul>
<li>
<p>Settings —&gt; Model Providers</p>
<ol>
<li>install model provder,</li>
<li>setting endpoint, API key, etc.</li>
</ol>
<ul>
<li>If failed to install model providers,
<ul>
<li>Download plugin pkg file from Dify Marketplace, and install it by Dify GUI: https://github.com/langgenius/dify/issues/14776</li>
<li>if the above failed,
<ul>
<li>(it may be better to delete this setting after installing model proiders)</li>
<li>vi docker-compose.yaml
<ul>
<li>https://qiita.com/k-hideo/items/d1cc1f3efff9d068dee7</li>
<li>add PROXY setting to <code>plugin_daemon</code> section<pre class="hljs"><code><div>...
plugin_daemon:
image: langgenius/dify-plugin-daemon:0.2.0-local
restart: always
environment:
  # Use the shared environment variables.
  &lt;&lt;: *shared-api-worker-env
  HTTP_PROXY: http://proxy.xxx.com:xxx
  HTTPS_PROXY: http://proxy.xxx.com:xxx
  NO_PROXY: localhost,127.0.0.1,weaviate,qdrand,db,redis,web,worker,plugin_daemon,plugin
  ...
</div></code></pre>
</li>
</ul>
</li>
</ul>
<ul>
<li>To see log from model provider installation process,
<ul>
<li><code>sudo docker logs -f docker-plugin_daemon-1</code></li>
<li>maybe, failed when installing python modules dependent on the provider plugin.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>When endpoint is local,</p>
<ul>
<li>LLM endpoint server should listen 0.0.0.0</li>
<li>Specify endpoint as IP address of host: http://IP_of_host:port/</li>
</ul>
</li>
</ul>
<h3 id="others">Others</h3>
<ul>
<li>Settings -&gt; languages -&gt; timezone</li>
</ul>
<h3 id="user-account-for-community-version">User Account for community version</h3>
<ul>
<li>login with mail address and password</li>
</ul>
<h1 id="text-embedding-model-for-rag">Text Embedding Model (for RAG)</h1>
<h3 id="ruri-large-model">ruri-large model</h3>
<p>https://docs.dify.ai/en/development/models-integration/ollama#integrate-local-models-deployed-by-ollama</p>
<ol>
<li>install ollama in Windows
<ul>
<li>-&gt; start Ollama in background</li>
</ul>
</li>
<li>change listen address:  default localhost -&gt; 0.0.0.0
<ol>
<li>click Ollama icon in task tray</li>
<li>click Setting -&gt; Check &quot;Expose Ollama to the network&quot;</li>
</ol>
</li>
<li>install uri-large model<pre class="hljs"><code><div><span class="hljs-comment"># download</span>
ollama pull kun432/cl<span class="hljs-literal">-nagoya</span><span class="hljs-literal">-ruri</span><span class="hljs-literal">-large</span>
ollama list  <span class="hljs-comment"># list pulled models</span>
<span class="hljs-comment"># start running model</span>
curl http://localhost:<span class="hljs-number">11434</span>/api/embed <span class="hljs-literal">-Method</span> Post <span class="hljs-literal">-ContentType</span> application/json <span class="hljs-literal">-Body</span> <span class="hljs-string">'{
  "model": "kun432/cl-nagoya-ruri-large",
  "input": "文章: 日本のAI技術の進展について教えてください。"
}'</span>
<span class="hljs-comment"># check models running</span>
ollama ps
<span class="hljs-comment"># stop model</span>
ollama stop kun432/cl<span class="hljs-literal">-nagoya</span><span class="hljs-literal">-ruri</span><span class="hljs-literal">-large</span>
</div></code></pre>
</li>
<li>Setting Firewall<pre class="hljs"><code><div><span class="hljs-comment"># set firewall</span>
netsh advfirewall firewall add rule name=<span class="hljs-string">"★Ollama TCP 11434"</span> dir=<span class="hljs-keyword">in</span> action=allow protocol=TCP localport=<span class="hljs-number">11434</span> profile=private,domain
<span class="hljs-comment"># show firewall</span>
netsh advfirewall firewall show rule name=<span class="hljs-string">"★Ollama TCP 11434"</span>
<span class="hljs-comment"># delete firewall</span>
netsh advfirewall firewall delete rule name=<span class="hljs-string">"★Ollama TCP 11434"</span>
</div></code></pre>
</li>
<li>Ollama starts an API service at:
<ul>
<li>default: <code>http://localhost:11434</code></li>
<li>setting OLLAMA_HOST: <code>http://$OLLAMA_HOST:11434</code></li>
</ul>
</li>
</ol>
<h1 id="wsl2-disk">WSL2 Disk</h1>
<h3 id=""></h3>
<p>https://learn.microsoft.com/ja-jp/windows/wsl/disk-space
https://qiita.com/siruku6/items/c91a40d460095013540d</p>
<ul>
<li>Check the amount of disk space available in the VHD for a Linux distribution<pre class="hljs"><code><div>wsl.exe --system -d ubuntu df -h /mnt/wslg/distro
</div></code></pre>
</li>
<li>get VHD file path name and its size<pre class="hljs"><code><div># get VHD file path
$vhd = Get-ChildItem -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Lxss | foreach { $_.GetValue(&quot;BasePath&quot;) + &quot;\&quot; + $_.GetValue(&quot;VhdFileName&quot;)}
# check size of used disk
ls $vhd
</div></code></pre>
<ul>
<li>basically VHD file size = used disk size in Ubuntu.</li>
<li>but even if reduce used disk in ubuntsu, the file size not reduced.</li>
</ul>
</li>
<li>To shrink disk in such case<pre class="hljs"><code><div>wsl --shutdown
diskpart
  select vdisk file=&quot;file/path/to/$vhd&quot;
  attach vdisk readonly
  compact vdisk
  detach vdisk
  exit
</div></code></pre>
</li>
</ul>
<h1 id="mcp-server">MCP server</h1>
<p>https://docs.dify.ai/ja-jp/plugins/best-practice/how-to-use-mcp-zapier
https://zenn.dev/upgradetech/articles/24a7d76133af4c</p>

</body>
</html>
